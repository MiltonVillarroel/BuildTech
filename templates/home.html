<!-- app/templates/home.html -->
{% extends 'base.html' %}

{% block content %}
<div class="container">
    <!-- Header de Bienvenida -->
    <div class="welcome-header">
        <h1>üè† Bienvenido, {{ current_user.first_name }}!</h1>
        <p class="text-muted">
            {% if current_user.has_role('admin') %}
                Panel de Administraci√≥n del Edificio
            {% else %}
                Departamento {{ current_user.departamento }}
            {% endif %}
        </p>
    </div>
    
    <!-- Bot√≥n de Asistente IA - NUEVO -->
    <div class="ai-assistant-banner">
        <div class="ai-content">
            <div class="ai-icon">ü§ñ</div>
            <div class="ai-text">
                <h3>¬øNecesitas Ayuda?</h3>
                <p>Nuestro asistente virtual est√° disponible 24/7 para resolver tus dudas</p>
            </div>
        </div>
        <a href="https://t.me/BuildTech_bot" target="_blank" class="btn-ai-chat">
            <span class="telegram-icon">‚úàÔ∏è</span>
            <span>Chat con Asistente</span>
        </a>
    </div>
    
    <!-- Dashboard seg√∫n Rol -->
    {% if current_user.has_role('admin') %}
    <!-- ============= DASHBOARD ADMINISTRADOR ============= -->
    <div class="dashboard-grid">
        <div class="dashboard-card card-mantenimiento">
            <div class="card-icon">‚öôÔ∏è</div>
            <h3>Mantenimiento</h3>
            <p>Gestiona tickets y solicitudes de mantenimiento del edificio</p>
            <div class="card-stats">
                <span class="stat-badge">üìä Ver Estad√≠sticas</span>
            </div>
            <div class="card-actions">
                <a href="{{ url_for('mantenimiento.list_mantenimiento') }}" class="btn btn-primary">
                    Ver Tickets
                </a>
                <a href="{{ url_for('mantenimiento.create_ticket') }}" class="btn btn-outline-primary">
                    Crear Nuevo
                </a>
            </div>
        </div>
        
        <div class="dashboard-card card-comunicacion">
            <div class="card-icon">üí¨</div>
            <h3>Comunicaci√≥n</h3>
            <p>Chat, avisos importantes y sistema de quejas de residentes</p>
            <div class="card-stats">
                <span class="stat-badge">üîî Notificaciones Activas</span>
            </div>
            <div class="card-actions">
                <a href="{{ url_for('comunicacion.avisos') }}" class="btn btn-success">
                    Ver Avisos
                </a>
                <a href="{{ url_for('comunicacion.quejas') }}" class="btn btn-outline-success">
                    Ver Quejas
                </a>
            </div>
        </div>
        
        <div class="dashboard-card card-finanzas">
            <div class="card-icon">üí∞</div>
            <h3>Finanzas</h3>
            <p>Control de pagos, cargos mensuales y gastos del edificio</p>
            <div class="card-stats">
                <span class="stat-badge">üíµ Balance Mensual</span>
            </div>
            <div class="card-actions">
                <a href="{{ url_for('finanzas.resumen_financiero') }}" class="btn btn-warning">
                    Ver Resumen
                </a>
            </div>
        </div>
        
        <div class="dashboard-card card-reservas">
            <div class="card-icon">üìÖ</div>
            <h3>Reservas</h3>
            <p>Administrar reservas de √°reas comunes y espacios del edificio</p>
            <div class="card-stats">
                <span class="stat-badge">üé´ Reservas Activas</span>
            </div>
            <div class="card-actions">
                <a href="{{ url_for('reservas.reservas_admin') }}" class="btn btn-info">
                    Administrar
                </a>
                <a href="{{ url_for('reservas.reservas') }}" class="btn btn-outline-info">
                    Nueva Reserva
                </a>
            </div>
        </div>
    </div>
    
    {% else %}
    <!-- ============= DASHBOARD RESIDENTE ============= -->
    <div class="dashboard-grid">
        <div class="dashboard-card card-ticket">
            <div class="card-icon">üîß</div>
            <h3>Reportar Problema</h3>
            <p>Crea un ticket de mantenimiento para reportar problemas en tu departamento o √°reas comunes</p>
            <div class="card-actions">
                <a href="{{ url_for('mantenimiento.create_ticket') }}" class="btn btn-primary btn-lg">
                    ‚ûï Crear Ticket
                </a>
                <a href="{{ url_for('mantenimiento.list_mantenimiento') }}" class="btn btn-outline-primary">
                    Ver Mis Tickets
                </a>
            </div>
        </div>
        
        <div class="dashboard-card card-reserva">
            <div class="card-icon">üìÖ</div>
            <h3>Reservar √Årea</h3>
            <p>Reserva salones de fiestas, √°reas de parrilla, piscina y m√°s espacios comunes</p>
            <div class="card-actions">
                <a href="{{ url_for('reservas.reservas') }}" class="btn btn-success btn-lg">
                    üìç Hacer Reserva
                </a>
            </div>
        </div>
        
        <div class="dashboard-card card-pagos">
            <div class="card-icon">üí≥</div>
            <h3>Mis Pagos</h3>
            <p>Consulta tus cargos mensuales, servicios y realiza pagos pendientes</p>
            <div class="card-actions">
                {% if current_user.departamento %}
                <a href="{{ url_for('finanzas.calcular_cargos_mensuales', departamento_id=current_user.departamento) }}" 
                   class="btn btn-warning btn-lg">
                    üí∞ Ver Cargos
                </a>
                {% else %}
                <button class="btn btn-secondary btn-lg" disabled>
                    Sin Departamento Asignado
                </button>
                {% endif %}
            </div>
        </div>
        
        <div class="dashboard-card card-chat">
            <div class="card-icon">üí¨</div>
            <h3>Comunicaci√≥n</h3>
            <p>Chat general del edificio, avisos importantes y env√≠a sugerencias o quejas</p>
            <div class="card-actions">
                <a href="{{ url_for('comunicacion.chat_general') }}" class="btn btn-info btn-lg">
                    üí¨ Ir al Chat
                </a>
                <a href="{{ url_for('comunicacion.avisos') }}" class="btn btn-outline-info">
                    Ver Avisos
                </a>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Secci√≥n de Acceso R√°pido -->
    <div class="quick-access mt-5">
        <h4>‚ö° Acceso R√°pido</h4>
        <div class="quick-links">
            <a href="{{ url_for('comunicacion.chat_general') }}" class="quick-link">
                <span class="icon">üí¨</span>
                <span class="text">Chat General</span>
            </a>
            <a href="{{ url_for('comunicacion.quejas') }}" class="quick-link">
                <span class="icon">üìù</span>
                <span class="text">Quejas/Sugerencias</span>
            </a>
            <a href="{{ url_for('comunicacion.avisos') }}" class="quick-link">
                <span class="icon">üì¢</span>
                <span class="text">Avisos</span>
            </a>
            {% if current_user.has_role('admin') %}
            <a href="{{ url_for('comunicacion.notificaciones') }}" class="quick-link">
                <span class="icon">üîî</span>
                <span class="text">Notificaciones</span>
            </a>
            {% endif %}
        </div>
    </div>
</div>

<style>
.welcome-header {
    text-align: center;
    padding: 2rem 0;
    margin-bottom: 2rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 16px;
    color: white;
}

.welcome-header h1 {
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
}

/* ============================================
   BANNER DE ASISTENTE IA - NUEVO
============================================ */
.ai-assistant-banner {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 2rem;
    margin-bottom: 3rem;
    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 2rem;
    animation: pulseGlow 3s ease-in-out infinite;
}

@keyframes pulseGlow {
    0%, 100% {
        box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
    }
    50% {
        box-shadow: 0 8px 32px rgba(102, 126, 234, 0.5);
    }
}

.ai-content {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    flex: 1;
}

.ai-icon {
    font-size: 4rem;
    animation: bounce 2s ease-in-out infinite;
}

@keyframes bounce {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-10px);
    }
}

.ai-text {
    color: white;
}

.ai-text h3 {
    font-size: 1.5rem;
    font-weight: bold;
    margin: 0 0 0.5rem 0;
}

.ai-text p {
    margin: 0;
    opacity: 0.9;
    font-size: 0.95rem;
}

.btn-ai-chat {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background: white;
    color: #667eea;
    padding: 1rem 2rem;
    border-radius: 50px;
    text-decoration: none;
    font-weight: bold;
    font-size: 1.1rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    white-space: nowrap;
}

.btn-ai-chat:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    background: #f8f9fa;
    color: #5568d3;
}

.telegram-icon {
    font-size: 1.5rem;
    animation: rotate 3s linear infinite;
}

@keyframes rotate {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

/* Responsive para m√≥vil */
@media (max-width: 768px) {
    .ai-assistant-banner {
        flex-direction: column;
        text-align: center;
        padding: 1.5rem;
    }
    
    .ai-content {
        flex-direction: column;
        text-align: center;
    }
    
    .ai-icon {
        font-size: 3rem;
    }
    
    .ai-text h3 {
        font-size: 1.3rem;
    }
    
    .ai-text p {
        font-size: 0.9rem;
    }
    
    .btn-ai-chat {
        width: 100%;
        justify-content: center;
        padding: 1rem 1.5rem;
        font-size: 1rem;
    }
}

/* Resto de estilos originales */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.dashboard-card {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: transform 0.3s, box-shadow 0.3s;
    border-left: 5px solid;
}

.dashboard-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
}

.card-mantenimiento { border-left-color: #3498db; }
.card-comunicacion { border-left-color: #27ae60; }
.card-finanzas { border-left-color: #f39c12; }
.card-reservas { border-left-color: #17a2b8; }
.card-ticket { border-left-color: #e74c3c; }
.card-reserva { border-left-color: #9b59b6; }
.card-pagos { border-left-color: #f39c12; }
.card-chat { border-left-color: #3498db; }

.card-icon {
    font-size: 4rem;
    text-align: center;
    margin-bottom: 1rem;
}

.dashboard-card h3 {
    font-size: 1.5rem;
    color: #2c3e50;
    margin-bottom: 1rem;
}

.dashboard-card p {
    color: #666;
    margin-bottom: 1.5rem;
    line-height: 1.6;
}

.card-stats {
    margin-bottom: 1.5rem;
}

.stat-badge {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: #f8f9fa;
    border-radius: 20px;
    font-size: 0.85rem;
    color: #666;
}

.card-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.card-actions .btn {
    flex: 1;
    min-width: 120px;
}

.quick-access {
    background: white;
    padding: 2rem;
    border-radius: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.quick-access h4 {
    margin-bottom: 1.5rem;
    color: #2c3e50;
}

.quick-links {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
}

.quick-link {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.5rem;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    text-decoration: none;
    color: #2c3e50;
    transition: all 0.3s;
}

.quick-link:hover {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    transform: scale(1.05);
}

.quick-link .icon {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
}

.quick-link .text {
    font-size: 0.9rem;
    font-weight: 600;
    text-align: center;
}

@media (max-width: 768px) {
    .welcome-header h1 {
        font-size: 1.8rem;
    }
    
    .dashboard-grid {
        grid-template-columns: 1fr;
    }
    
    .card-actions {
        flex-direction: column;
    }
    
    .card-actions .btn {
        width: 100%;
    }
    
    .quick-links {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>
{% endblock %}